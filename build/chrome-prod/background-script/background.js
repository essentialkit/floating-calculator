(()=>{var r=class{constructor(){this.RELOAD_ACTION={menu:{id:"reload-extension",title:"Reload Extension",visible:!0,contexts:["action"]},handler:e=>{chrome.runtime.reload()}};this.FLOATING_CALC_ACTION={menu:{id:"show-calculator",title:"Floating Calculator",visible:!0,contexts:["all"]},handler:e=>{this.sendMessage({action:"toggle-calculator",data:""})}};this.browserActionContextMenu=[this.RELOAD_ACTION,this.FLOATING_CALC_ACTION];this.init=()=>{if(!chrome||!chrome.contextMenus){console.warn("No access to chrome.contextMenus");return}chrome.contextMenus.removeAll(),this.browserActionContextMenu.forEach(e=>chrome.contextMenus.create(e.menu)),chrome.contextMenus.onClicked.addListener(this.onClick)};this.onClick=(e,o)=>{let n=this.browserActionContextMenu.find(s=>s.menu.id===e.menuItemId);n?n.handler(e,o):console.error("Unable to find menu item: ",e)}}sendMessage(e){chrome.tabs.query({active:!0,currentWindow:!0},o=>{chrome.tabs.sendMessage(o[0].id,e,n=>{console.debug("ack:",n)})})}};new r().init();var c="https://forms.gle/oRACFiJQCZW77Ssu8",a=chrome.runtime.getURL("welcome/welcome.html"),i=t=>{t.reason==="install"&&chrome.tabs.create({url:a,active:!0}),chrome.runtime.setUninstallURL(c,()=>{chrome.runtime.lastError&&console.error("Error setting uninstall URL",chrome.runtime.lastError)})};chrome.runtime.onInstalled.addListener(i);var l=(t,e,o)=>{console.log("Received message: ",t," from: ",e),chrome.tabs.query({active:!0,currentWindow:!0},n=>{if(n.length==0){console.error("Unexpected state: No active tab");return}chrome.tabs.sendMessage(n[0].id,t,s=>{o(s)})})};chrome.runtime.onMessage.addListener(l);chrome.action.onClicked.addListener(t=>{if(!t.id){console.error("BG: click on tab without an id",t);return}chrome.tabs.sendMessage(t.id,{action:"toggle-calculator"},e=>{console.log("BG: received",e)})});})();
